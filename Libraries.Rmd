---
title: "Libraries"
author: "Kabilan Kathiravel"
date: "05/12/2021"
output: 
  learnr::tutorial:
    progressive: true
    allow_skip: true
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
gradethis::gradethis_setup()
```


```{r cars, include = FALSE}
library(learnr)
library(tidyverse)
options(repos = "https://cran.stat.auckland.ac.nz/")
library(palmerpenguins)
library(sortable)
set.seed(1)
```

## Welcome

This is a tutorial on libraries in R and the pipe operator. If you are not sure what a library is in this context, please check out [this link](https://hbctraining.github.io/Intro-to-R-flipped/lessons/04_introR_packages.html) to get some idea before trying the exercises. For the pipe operator try [here](https://style.tidyverse.org/pipes.html).

In this tutorial you will learn about:

- Loading and installing libraries
- Getting help to understand a specific library in R
- The pipe operator (%>%)

## Install packages

Let's have a look at the [Palmer Penguins dataset](https://allisonhorst.github.io/palmerpenguins/articles/intro.html). It contains size measurements for three penguin species observed on three islands in Antarctica's Palmer Archipelago. 

If we don't have the package installed in R, we have to do so.

```{r installex1, echo=FALSE}
question("Which of the following commands installs the palmerpenguins library in R?",
  answer("install(palmerpenguins)"),
  answer("library(tidyverse)"),
  answer("install.packages('palmerpenguins')", correct = TRUE),
  answer("open sesame")
)
```
```{r installex2, echo=FALSE}
correct_penguins <- c(
    "install.packages('palmerpenguins')",
    "library(palmerpenguins)",
    "penguins %>% head()"
  )

question_rank(
  "Assuming you don't have the Palmer Penguins data in R on your computer, order the following so you can access the first six rows",
  answer(correct_penguins, correct = TRUE),
  answer(rev(correct_penguins), correct = FALSE,
         message = "Should you access the data before you load the library? Or load the library before you install it?"
         ),
  allow_retry = TRUE
)

```
```{r installex3, echo=FALSE}
question("Which of the following would be an appropriate step to take after getting this R error message - Error in library(palmerpenguins) : there is no package called ‘palmerpenguins’? Select all that apply. ?",
  answer("Yell at your computer"),
  answer("Running install.packages(\"palmerpenguins\")", correct = TRUE),
  answer("Check that \"palmerpenguins\" precisely is the name of the package that you want to use", correct = TRUE),
  answer("Ignore the error message and continue running the code that follows"),
  allow_retry = TRUE
)
```
```{r installex4, echo=FALSE}
question("You want to find out more about the palmerpenguins library before deciding to use it. If you can't use Google, which of the following SHOULD you do?",
  answer("Double check that you have palmerpenguins installed in your environment", correct = TRUE),
  answer("Run help(\"palmerpenguins\")"),
  answer("Run ?palmerpenguins"),
  answer("Run help.search(\"palmerpenguins\")", correct = TRUE),
  answer("Run ??palmerpenguins", correct = TRUE),
  allow_retry = TRUE
)
```

## Debugging

We want to load all the Palmer Penguins data. However we have an error (run this to see it). Correct the code to get the Palmer Penguins tibble.

```{r debugex1, exercise = TRUE}
penguin
```
```{r debugex1-check}
grade_result(
  pass_if(~identical(.result, penguins))
)
```

We want to drop all NA rows. Correct the code below to allow this to happen.

```{r debugex2, exercise = TRUE}
penguins  %>% dropna
```
```{r debugex2-check}
grade_result(
  pass_if(~identical(.result, penguins  %>% drop_na()))
)
```

You want to only analyse penguins in 'Torgersen' island. Adapt the code below to do that.

```{r debugex3, exercise = TRUE}
(island == "Torgersen") %>% filter(penguins)
```
```{r debugex3-check}
grade_result(
  pass_if(~identical(.result, penguins %>% filter(island == "Torgersen")))
)
```


Change one part of the if statement so number == 3.

```{r debugex4, exercise = TRUE}
number = 0
if (3>6) {
  number = 3
}
number
```
```{r debugex4-check}
grade_result(
  pass_if(~identical(.result, 3))
)
```

Repeat 10 20 times in R. 

```{r debugex5, exercise = TRUE}
rep(2321, 10)
```
```{r debugex5-check}
grade_result(
  pass_if(~identical(.result, rep(10, 20)))
)
```

Put in the right index to return the last number in series b (avoid the temptation to write the answer directly :) )

```{r debugex6, exercise = TRUE}
b <- 10:20
b[29]
```
```{r debugex6-check}
grade_result(
  pass_if(~identical(as.numeric(.result), 20))
)
```


## Piping

Now we have each library we need - excellent! Now we can get to looking at the data using the penguins dataset it is loaded to.

Let's have a look at the first six rows, using the pipe operator (%>%).

```{r pipeex1, exercise = TRUE}
    
```
```{r pipeex1-check}
grade_result(
  pass_if(~identical(.result, penguins %>% head()))
)
```

<div id="pipeex1-hint">
**Hint:** This is the use of the `head()` function.
</div>

Just from looking at the head, you may notice that there are some null (NA) values. It may be worthwhile getting a feel for which rows are like this. Start by filtering rows with null values for 'sex'.

```{r pipeex2, exercise = TRUE}
    
```

```{r pipeex2-check}
grade_result(
  pass_if(~identical(.result, penguins %>%
  filter(is.na(sex))))
)
```

How can you get the mean body mass of each year (call this "average_mass") in kg (without worrying about N/A values)?

```{r pipeex3, exercise = TRUE}

```

```{r pipeex3-check}
grade_result(
  pass_if(~identical(.result, penguins %>%
  group_by(year) %>%
    summarize(average_mass = mean(body_mass_g) / 1000)))
)
```

What was the highest flipper length (in mm) of any penguin in 2008?

```{r pipeex4, exercise = TRUE}

```

```{r pipeex4-check}
grade_result(
  pass_if(~identical(.result, penguins %>%
  group_by(year) %>%
    summarize(average_mass = mean(body_mass_g) / 1000)))
)
```

How many of species "Adelie" were found in island "Dream" in 2007 (call the answer "count")?

```{r pipeex5, exercise = TRUE}

```

```{r pipeex5-check}
grade_result(
  pass_if(~identical(.result, penguins %>%
    filter(year == 2007 & species == "Adelie" & island == "Dream") %>%
      summarise(count = n())))
)
```




## Visualisation

For visualisation we can use ggplot2. For example, we might want to see how flipper length varies with bill length. To do so, we can plot a scatter plot linking the two. Replace the "haha"'s with the appropriate variable names to see this.


```{r visex1, exercise = TRUE}
ggplot(data = haha) +
   aes(x = haha, y = haha) +
   geom_point()
```
```{r visex1-solution}
ggplot(data = penguins) +
   aes(x = bill_length_mm, y = flipper_length_mm) +
   geom_point()
```
```{r visex1-check}
grade_this_code("Great work!")
```

Following from the above, what if we want to clearly see the difference in relationship between flipper length and bill length by sex (male or female, as defined in our dataset)? Using the correct answer from above, replace the appropriate "haha"'s to add to it so male is blue and female is green.  

```{r visex2, exercise = TRUE}
ggplot(data = haha) +
   aes(x = haha, y = haha) +
   geom_point(aes(color = haha)) +
  scale_color_manual(values = c(haha, haha))
```
```{r visex2-solution}
ggplot(data = penguins) +
   aes(x = bill_length_mm, y = flipper_length_mm) +
   geom_point(aes(color = sex)) +
  scale_color_manual(values = c("green", "blue"))
```
```{r visex2-check}
grade_this_code("Great work!")
```

Great work! However from above, we are reminded that N/A values are in the data, since we used the initial data. Following from the above code, use the appropriate function to remove all rows with N/A from the data.

```{r visex3, exercise = TRUE}
ggplot(data = haha %>% haha) +
   aes(x = haha, y = haha) +
   geom_point(aes(color = haha)) +
  scale_color_manual(values = c(haha, haha))
```
```{r visex3-solution}
ggplot(data = penguins  %>% drop_na()) +
   aes(x = bill_length_mm, y = flipper_length_mm) +
   geom_point(aes(color = sex)) +
  scale_color_manual(values = c("green", "blue"))
```
```{r visex3-check}
grade_this_code("Great work!")
```

Looking good! However, for an outsider looking at the plot, seeing the variable names on the x and y axis might feel strange. Add labels so you see "Bill length (mm)" and "Flipper length (mm)" on the appropriate axes instead.

```{r visex4, exercise = TRUE}
ggplot(data = haha %>% haha) +
   aes(x = haha, y = haha) +
   geom_point(aes(color = haha)) +
  scale_color_manual(values = c(haha, haha)) +
  xlab(haha) +
  ylab(haha)
```
```{r visex4-solution}
ggplot(data = penguins  %>% drop_na()) +
   aes(x = bill_length_mm, y = flipper_length_mm) +
   geom_point(aes(color = sex)) +
  scale_color_manual(values = c("green", "blue")) +
  xlab("Bill length (mm)") +
  ylab("Flipper length (mm)")
```
```{r visex4-check}
grade_this_code("Great work!")
```

To make things clearer, we may like to put a title. Put in the title "Plot of bill length against flipper length".


```{r visex5, exercise = TRUE}
ggplot(data = haha %>% haha) +
   aes(x = haha, y = haha) +
   geom_point(aes(color = haha)) +
  scale_color_manual(values = c(haha, haha)) +
  ggtitle(haha) +
  xlab(haha) +
  ylab(haha)
```
```{r visex5-solution}
ggplot(data = penguins  %>% drop_na()) +
   aes(x = bill_length_mm, y = flipper_length_mm) +
   geom_point(aes(color = sex)) +
  scale_color_manual(values = c("green", "blue")) +
  ggtitle("Plot of bill length against flipper length") +
  xlab("Bill length (mm)") +
  ylab("Flipper length (mm)")
```
```{r visex5-check}
grade_this_code("Great work!")
```

Final addition - let's make this plot look classic. That means clear x and y axis lines and no gridlines. Replace the last "haha" with the appropriate word completing the function.

```{r visex6, exercise = TRUE}
ggplot(data = haha %>% haha) +
   aes(x = haha, y = haha) +
   geom_point(aes(color = haha)) +
  scale_color_manual(values = c(haha, haha)) +
  ggtitle(haha) +
  xlab(haha) +
  ylab(haha) +
  theme_haha()
```
```{r visex6-solution}
ggplot(data = penguins  %>% drop_na()) +
   aes(x = bill_length_mm, y = flipper_length_mm) +
   geom_point(aes(color = sex)) +
  scale_color_manual(values = c("green", "blue")) +
  ggtitle("Plot of bill length against flipper length") +
  xlab("Bill length (mm)") +
  ylab("Flipper length (mm)") +
  theme_classic()
```
```{r visex6-check}
grade_this_code("Great work!")
```


## Questions

```{r mcq, echo=FALSE}
question("Which of the following will cause a compiler error?",
   answer("i_like_tidyversed <- TRUE"),
   answer("library(tidyverse)"),
   answer("install.packages('tidyverse'))", correct = TRUE),
   answer("some_number <- 3 * 6231 - 4") 
 )
 ```
 ```{r mcq2, echo=FALSE}
question("What is the most likely cause of Error: Object \"avocado\" not found?",
   answer("The object avocado does not exist in your console"),
   answer("The function avocado() does not exist in your current environment", correct = TRUE),
   answer("The object avocado does not exist in your working directory"),
   answer("The object avocado does not exist in your current environment"),
   answer("The file avocado.csv does not exist in your working directory") 
 )
 ```
  ```{r mcq3, echo=FALSE}
question("You have a dataset filled with information about several different people and whether they have diabetes or not called 'diabetes.csv' and you load it into your R program under the variable name 'diabetes'. You see that the data's fields are 'gender', 'age', 'BMI', 'glucose', 'age' and 'diabetes'. You want to explore the data. Which of the following expressions are valid?.",
   answer("diabete %>% groupby('age') %>% summarize(average_bmi = mean(BMI))"),
   answer("diabetes %>% groupby('age', 'gender') %>% summarize(average_bmi = mean(BMI))", correct = TRUE),
   answer("diabetes %>% groupby('age', 'gender) %>% summarize(average_bmi = mean(BMI))"),
   answer("diabetes %>% groupby('age', 'gender') %>% summarize(average_bmi = mean(bmi))") 
 )
 ```
   ```{r mcq4, echo=FALSE}
question("Which of the following would get you the average 'height' for the tibble 'elephants' in each 'nation'?",
   answer("elephants %>% summarize(average_height) %>% group_by(nation)"),
   answer("elephants %<% group_by(nation) %<% summarize(average_height = mean(height)"),
   answer("elephants %>% group_by(nation, creed) %>% summarize(mean(height))"),
   answer("elephants %>% group_by(nation) %>% summarize(average_height = mean(height))", correct = TRUE) 
 )
 ```
```{r mcq5, echo=FALSE}
question("Which of the following is the most likely reason for getting the following R error message Error in data %>% mean(x) : could not find function \"%>%\"?",
   answer("The function mean() does not exist"),
   answer("The gatekeepers of the universe casted a curse on your R"),
   answer("You haven’t loaded the package that contains the function %>%", correct = TRUE),
   answer("The object data does not contain a column named x") 
 )
 ```
 ```{r mcq6, echo=FALSE}
question("Which of the following shows how to express 'filter(penguins_nafree, island == \"Torgersen\"' through piping?"
,
   answer("(island == \"Torgersen\") %>% filter(penguins_nafree)"),
   answer("penguins_nafree %>% filter(island == \"Torgerson\")"),
   answer("penguins_nafree %<% filter(island == \"Torgersen\")"),
   answer("None of the above", correct = TRUE) 
 )
 ```




